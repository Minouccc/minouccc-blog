---
title: ğŸš€ è·¯ç”±ç¯‡ é“¾æ¥ä¸å¯¼èˆª
date: '2024-06-15'
tags: ['nextjs']
draft: false
summary: æœ¬ç¯‡æˆ‘ä»¬è®²è®²å¦‚ä½•åœ¨ Next.js ä¸­å®ç°é“¾æ¥å’Œå¯¼èˆªã€‚
---

## å‰è¨€

æ‰€è°“â€œå¯¼èˆªâ€ï¼ŒæŒ‡çš„æ˜¯ä½¿ç”¨ JavaScript è¿›è¡Œé¡µé¢åˆ‡æ¢ï¼Œé€šå¸¸ä¼šæ¯”æµè§ˆå™¨é»˜è®¤çš„é‡æ–°åŠ è½½æ›´å¿«ï¼Œå› ä¸ºåœ¨å¯¼èˆªçš„æ—¶å€™ï¼Œåªä¼šæ›´æ–°å¿…è¦çš„ç»„ä»¶ï¼Œè€Œä¸ä¼šé‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚

åœ¨ Next.js ä¸­ï¼Œæœ‰ 4 ç§æ–¹å¼å¯ä»¥å®ç°è·¯ç”±å¯¼èˆªï¼š

1.  ä½¿ç”¨ `<Link>` ç»„ä»¶
2.  ä½¿ç”¨ `useRouter` Hookï¼ˆå®¢æˆ·ç«¯ç»„ä»¶ï¼‰
3.  ä½¿ç”¨ `redirect` å‡½æ•°ï¼ˆæœåŠ¡ç«¯ç»„ä»¶ï¼‰
4.  ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ History API

## `<Link>`ç»„ä»¶

Next.js çš„`<Link>`ç»„ä»¶æ˜¯ä¸€ä¸ªæ‹“å±•äº†åŸç”Ÿ HTML `<a>` æ ‡ç­¾çš„å†…ç½®ç»„ä»¶ï¼Œç”¨æ¥å®ç°é¢„è·å–ï¼ˆprefetchingï¼‰ å’Œå®¢æˆ·ç«¯è·¯ç”±å¯¼èˆªã€‚è¿™æ˜¯ Next.js ä¸­è·¯ç”±å¯¼èˆªçš„ä¸»è¦å’Œæ¨èæ–¹å¼ã€‚

#### åŸºç¡€ä½¿ç”¨

åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

```javascript
import Link from 'next/link'

export default function Page() {
  return <Link href="/dashboard">Dashboard</Link>
}
```

#### æ”¯æŒåŠ¨æ€æ¸²æŸ“

æ”¯æŒè·¯ç”±é“¾æ¥åŠ¨æ€æ¸²æŸ“ï¼š

```javascript
import Link from 'next/link'

export default function PostList({ posts }) {
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>
          <Link href={`/blog/${post.slug}`}>{post.title}</Link>
        </li>
      ))}
    </ul>
  )
}
```

#### è·å–å½“å‰è·¯å¾„å

å¦‚æœéœ€è¦å¯¹å½“å‰é“¾æ¥è¿›è¡Œåˆ¤æ–­ï¼Œä½ å¯ä»¥ä½¿ç”¨ [usePathname()](https://juejin.cn/book/7307859898316881957/section/7309079651500949530#heading-54) ï¼Œå®ƒä¼šè¯»å–å½“å‰ URL çš„è·¯å¾„åï¼ˆpathnameï¼‰ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```javascript
'use client'

import { usePathname } from 'next/navigation'
import Link from 'next/link'

export function Navigation({ navLinks }) {
  const pathname = usePathname()

  return (
    <>
      {navLinks.map((link) => {
        const isActive = pathname === link.href

        return (
          <Link className={isActive ? 'text-blue' : 'text-black'} href={link.href} key={link.name}>
            {link.name}
          </Link>
        )
      })}
    </>
  )
}
```

#### è·³è½¬è¡Œä¸ºè®¾ç½®

App Router çš„é»˜è®¤è¡Œä¸ºæ˜¯æ»šåŠ¨åˆ°æ–°è·¯ç”±çš„é¡¶éƒ¨ï¼Œæˆ–è€…åœ¨å‰è¿›åé€€å¯¼èˆªæ—¶ç»´æŒä¹‹å‰çš„æ»šåŠ¨è·ç¦»ã€‚

å¦‚æœä½ æƒ³è¦ç¦ç”¨è¿™ä¸ªè¡Œä¸ºï¼Œä½ å¯ä»¥ç»™ `<Link>` ç»„ä»¶ä¼ é€’ä¸€ä¸ª `scroll={false}`å±æ€§ï¼Œæˆ–è€…åœ¨ä½¿ç”¨ `router.push`å’Œ `router.replace`çš„æ—¶å€™ï¼Œè®¾ç½® `scroll: false`ï¼š

```javascript
// next/link
<Link href="/dashboard" scroll={false}>
  Dashboard
</Link>
```

```javascript
// useRouter
import { useRouter } from 'next/navigation'

const router = useRouter()

router.push('/dashboard', { scroll: false })
```

## useRouter() hook

ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨ useRouterï¼Œè¿™æ˜¯ Next.js æä¾›çš„ç”¨äºæ›´æ”¹è·¯ç”±çš„ hookã€‚ä½¿ç”¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```javascript
'use client'

import { useRouter } from 'next/navigation'

export default function Page() {
  const router = useRouter()

  return (
    <button type="button" onClick={() => router.push('/dashboard')}>
      Dashboard
    </button>
  )
}
```

æ³¨æ„ä½¿ç”¨è¯¥ hook éœ€è¦åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ã€‚ï¼ˆé¡¶å±‚çš„ `'use client'` å°±æ˜¯å£°æ˜è¿™æ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼‰

æ³¨ï¼šå…³äº useRouter() hook çš„å…·ä½“ç”¨æ³•ï¼Œæˆ‘ä»¬ä¼šåœ¨[ã€ŠAPI ç¯‡ | å¸¸ç”¨å‡½æ•°ä¸æ–¹æ³•ï¼ˆä¸Šï¼‰ã€‹](https://juejin.cn/book/7307859898316881957/section/7309079651500949530#heading-58) ä¸­è¯¦ç»†ä»‹ç»ã€‚

## redirect å‡½æ•°

å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨ useRouter hookï¼ŒæœåŠ¡ç«¯ç»„ä»¶åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ redirect å‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯ Next.js æä¾›çš„ APIï¼Œä½¿ç”¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```javascript
import { redirect } from 'next/navigation'

async function fetchTeam(id) {
  const res = await fetch('https://...')
  if (!res.ok) return undefined
  return res.json()
}

export default async function Profile({ params }) {
  const team = await fetchTeam(params.id)
  if (!team) {
    redirect('/login')
  }

  // ...
}
```

## History API

ä¹Ÿå¯ä»¥ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿçš„ [window.history.pushState](https://developer.mozilla.org/en-US/docs/Web/API/History/pushState) å’Œ [window.history.replaceState](https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState) æ–¹æ³•æ›´æ–°æµè§ˆå™¨çš„å†å²è®°å½•å †æ ˆã€‚é€šå¸¸ä¸ usePathnameï¼ˆè·å–è·¯å¾„åçš„ hookï¼‰ å’Œ useSearchParamsï¼ˆè·å–é¡µé¢å‚æ•°çš„ hookï¼‰ ä¸€èµ·ä½¿ç”¨ã€‚

æ¯”å¦‚ç”¨ pushState å¯¹åˆ—è¡¨è¿›è¡Œæ’åºï¼š

```javascript
'use client'

import { useSearchParams } from 'next/navigation'

export default function SortProducts() {
  const searchParams = useSearchParams()

  function updateSorting(sortOrder) {
    const params = new URLSearchParams(searchParams.toString())
    params.set('sort', sortOrder)
    window.history.pushState(null, '', `?${params.toString()}`)
  }

  return (
    <>
      <button onClick={() => updateSorting('asc')}>Sort Ascending</button>
      <button onClick={() => updateSorting('desc')}>Sort Descending</button>
    </>
  )
}
```

replaceState ä¼šæ›¿æ¢æµè§ˆå™¨å†å²å †æ ˆçš„å½“å‰æ¡ç›®ï¼Œæ›¿æ¢åç”¨æˆ·æ— æ³•åé€€ï¼Œæ¯”å¦‚åˆ‡æ¢åº”ç”¨çš„åœ°åŸŸè®¾ç½®ï¼ˆå›½é™…åŒ–ï¼‰ï¼š

```javascript
'use client'

import { usePathname } from 'next/navigation'

export default function LocaleSwitcher() {
  const pathname = usePathname()

  function switchLocale(locale) {
    // e.g. '/en/about' or '/fr/contact'
    const newPath = `/${locale}${pathname}`
    window.history.replaceState(null, '', newPath)
  }

  return (
    <>
      <button onClick={() => switchLocale('en')}>English</button>
      <button onClick={() => switchLocale('fr')}>French</button>
    </>
  )
}
```

## å‚è€ƒé“¾æ¥

- [Linking and Navigating](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating)
