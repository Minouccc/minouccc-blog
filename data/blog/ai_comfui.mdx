---
title: 💡 ComfyUI
date: '2024-05-16'
tags: ['ai']
draft: false
summary: 关于 ComyUI 的一些基础知识。
---

### StableDiffusion的内在运行原理

在我们输入完提示词之后，文本编码器的 Clip 模型会将提示词转为特征向量,然后再由 VAE 编码器将特征向量传入潜空间内。

这些特征向量在潜空间内不断降噪，最后再由 VAE 解码器，将这些经过降噪后的特征向量解码成由于各个像素所组成的图片。

![1.png](http://blog.minouccc.online:9000/blog/frontend_1.1.png)

### 文生图工作流程

1. 在我们输入完正负向提示词后，文本编码器内的`Clip 模型`会将我们的提示词转为特征向量，输送到`k采样器`内

   - 文本编码器的 Clip 模型从哪里来的？

     答： 来自于`Checkpoint`加载器，这个加载主要用来加载各种大模型。而文本编码器的 Clip 模型是属于各个大模型的内置Clip模型。
     不同的大模型之间, Clip 模型也会有所差异。

2. 从`Checkpoint`加载器的输出可以知道它提供了`VAE模型`,而`VAE解码器`的作用就是将`k采样器`经过了降噪之后的潜空间图像解码成像素空间的图像。
3. `Ctrl+Enter`生成图像，而`空Latent`这里可以调整宽高（8的倍数）、批次大小。

### 提示词相关语法

#### 书写规范

- 不管正向还是负向提示词，一定要是英文的标点符号。

#### 提示词权重

- 给提示词加上中括号后，权重是 [cat:0.9]
- `{cat:1.05}`
- `(cat:1.1)`
- `[[cat]] 0.9\*0.9=0.81`
- `((cat)) 1.1\*1.1=1.21`

#### 短句和长句

- 两种都可以，但使用短句，也就是一个个词描述，可以方便调整权重。字数控制75字之内。

#### 提示词书写

越靠前的提示词权重会有所增加。

- No.1 画质词 / 画风词 high quality / high detail / 4k masterpiece

- No.2 主体 1girl

- No.3 环境/场景/构图 garden / white bg / soft light

- No.4 lora

#### 提示词污染

用`break`隔开提示词，尤其是防止颜色污染。

#### 提示词融合

- 1girl,cat -> 女孩抱着猫
- 1girl_cat / 1girl AND cat / [girl|cat] -> 猫娘

#### 控制生成时间段

- 前30%生成forest 后70%生成girl `{forest:1girl:0.3}`
