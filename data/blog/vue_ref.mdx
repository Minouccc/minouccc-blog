---
title: ğŸš€å¿«é€ŸæŒæ¡ Vue3 è¯­æ³• - ref
date: '2024-03-15'
tags: ['vue']
draft: false
summary: æœ¬æ–‡å°†å¸®åŠ©ä½ å…¨é¢ç†è§£ ref çš„ä½¿ç”¨æ–¹æ³•å’Œå„ç§ç‰¹æ€§ã€‚
---

# Vue3 ä¸­çš„ ref æŒ‡å—

åœ¨ Vue3 ä¸­ï¼Œ`ref` æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å“åº”å¼ APIã€‚æœ¬æ–‡å°†å¸®åŠ©ä½ å…¨é¢ç†è§£ ref çš„ä½¿ç”¨æ–¹æ³•å’Œå„ç§ç‰¹æ€§ã€‚

## 1. ref åŸºç¡€ä½¿ç”¨

ref ç”¨äºåˆ›å»ºä¸€ä¸ªå“åº”å¼çš„æ•°æ®å¼•ç”¨ã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨ JavaScript ä¸­è®¿é—® ref å€¼æ—¶ï¼Œéœ€è¦ä½¿ç”¨ `.value`ï¼Œä½†åœ¨æ¨¡æ¿ä¸­ä¼šè‡ªåŠ¨è§£åŒ…ã€‚

```typescript
<script setup lang="ts">
import { ref, Ref } from 'vue'

// ç±»å‹å®šä¹‰
type Person = {
  name: string
}

// ä¸¤ç§ç±»å‹å£°æ˜æ–¹å¼
const person = ref<Person>({ name: 'minou' })
const person1: Ref<Person> = ref({ name: 'minou' })

const changeName = () => {
  person.value.name = 'Minou' // é€šè¿‡ .value è®¿é—®å’Œä¿®æ”¹
}
</script>

<template>
  <div>{{ person }}</div>
  <!-- æ¨¡æ¿ä¸­è‡ªåŠ¨è§£åŒ…ï¼Œä¸éœ€è¦ .value -->
  <button @click="changeName">ä¿®æ”¹åå­—</button>
</template>
```

## 2. isRef æ£€æŸ¥

Vue3 æä¾›äº† `isRef` æ–¹æ³•æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸º ref å¯¹è±¡ï¼š

```typescript
import { isRef, ref } from 'vue'

const name = ref('minou')
console.log(isRef(name)) // true
console.log(isRef('minou')) // false
```

## 3. shallowRef vs ref

Vue3 æä¾›äº†ä¸¤ç§ refï¼š

- `ref`: æ·±å±‚å“åº”å¼ï¼Œä¼šé€’å½’åœ°ä½¿æ‰€æœ‰åµŒå¥—å±æ€§éƒ½å˜æˆå“åº”å¼
- `shallowRef`: æµ…å±‚å“åº”å¼ï¼Œåªåœ¨ `.value` å±‚é¢æ˜¯å“åº”å¼çš„

```typescript
<script setup lang="ts">
import { shallowRef, triggerRef } from 'vue'

const shallow = shallowRef({ name: 'minou' })

// æ–¹å¼1ï¼šç›´æ¥ä¿®æ”¹ .valueï¼Œä¼šè§¦å‘æ›´æ–°
shallow.value = { name: 'Minou' }

// æ–¹å¼2ï¼šä¿®æ”¹å†…éƒ¨å±æ€§éœ€è¦æ‰‹åŠ¨è§¦å‘æ›´æ–°
shallow.value.name = 'Minou'
triggerRef(shallow) // æ‰‹åŠ¨è§¦å‘æ›´æ–°
</script>
```

## 4. customRef è‡ªå®šä¹‰ ref

`customRef` å…è®¸æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰çš„ refï¼Œå®Œå…¨æ§åˆ¶ä¾èµ–è¿½è¸ªå’Œè§¦å‘æ›´æ–°çš„æ—¶æœºã€‚è¿™å¯¹äºå®ç°é˜²æŠ–ã€èŠ‚æµç­‰åŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚

```typescript
import { customRef } from 'vue'

// åˆ›å»ºä¸€ä¸ªå¸¦é˜²æŠ–åŠŸèƒ½çš„ ref
function useDebouncedRef(value, delay = 200) {
  let timeout
  return customRef((track, trigger) => {
    return {
      get() {
        track() // è¿½è¸ªä¾èµ–
        return value
      },
      set(newValue) {
        clearTimeout(timeout)
        timeout = setTimeout(() => {
          value = newValue
          trigger() // è§¦å‘æ›´æ–°
        }, delay)
      },
    }
  })
}
```

## 5. ref è·å– DOM å…ƒç´ 

ref è¿˜å¯ä»¥ç”¨æ¥è·å–æ¨¡æ¿ä¸­çš„ DOM å…ƒç´ ï¼š

```typescript
<script setup lang="ts">
import { ref, onMounted } from 'vue'

const domRef = ref<HTMLDivElement>()

onMounted(() => {
  // åœ¨ç»„ä»¶æŒ‚è½½åæ‰èƒ½è®¿é—® DOM
  console.log(domRef.value?.innerHTML)
})
</script>

<template>
  <div ref="domRef">Hello Vue</div>
</template>
```

## æ³¨æ„äº‹é¡¹

1. åœ¨ `<script setup>` ä¸­è®¿é—® ref å€¼æ—¶å¿…é¡»ä½¿ç”¨ `.value`
2. åœ¨æ¨¡æ¿ä¸­ä¸éœ€è¦ä½¿ç”¨ `.value`ï¼ŒVue ä¼šè‡ªåŠ¨è§£åŒ…
3. `shallowRef` ä¿®æ”¹å†…éƒ¨å±æ€§æ—¶éœ€è¦æ‰‹åŠ¨è°ƒç”¨ `triggerRef` è§¦å‘æ›´æ–°
4. DOM ref åªèƒ½åœ¨ç»„ä»¶æŒ‚è½½åè®¿é—®

## æœ€ä½³å®è·µ

1. ä½¿ç”¨ TypeScript æ—¶ï¼Œå»ºè®®ä¸º ref å®šä¹‰æ˜ç¡®çš„ç±»å‹
2. å½“åªéœ€è¦è¡¨å±‚å“åº”å¼æ—¶ï¼Œä½¿ç”¨ `shallowRef` å¯ä»¥æé«˜æ€§èƒ½
3. éœ€è¦è‡ªå®šä¹‰å“åº”å¼è¡Œä¸ºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `customRef`
4. è·å– DOM å…ƒç´ æ—¶ï¼Œç¡®ä¿åœ¨ `onMounted` ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­æ“ä½œ

é€šè¿‡åˆç†ä½¿ç”¨è¿™äº› ref APIï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºæ›´åŠ çµæ´»å’Œé«˜æ•ˆçš„ Vue åº”ç”¨ã€‚
