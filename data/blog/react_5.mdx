---
title: ğŸš€ã€ä¼˜åŒ–ç¯‡ã€‘æ¸²æŸ“è°ƒä¼˜
date: '2024-07-03'
tags: ['react']
draft: false
summary: è°ˆä¸€è°ˆæ•´ä¸ª React æ¸²æŸ“è¿‡ç¨‹ä¸­ç»†èŠ‚é—®é¢˜æ€ä¹ˆè§£å†³ã€‚
---

## ä¸€ å‰è¨€

é€šè¿‡æœ¬ç« èŠ‚ï¼Œä½ å°†å­¦ä¼š Suspense ç”¨æ³•å’ŒåŸç†ï¼ŒReact.lazy ç”¨æ³•å’Œé…åˆ Suspense å®ç°ä»£ç åˆ†å‰²ï¼Œæ¸²æŸ“é”™è¯¯è¾¹ç•Œã€æ¸²æŸ“å¼‚å¸¸çš„å¤„ç†æ‰‹æ®µï¼Œ ä»¥åŠ diff æµç¨‹ä»¥åŠ key çš„åˆç†ä½¿ç”¨ã€‚

## äºŒæ‡’åŠ è½½å’Œå¼‚æ­¥æ¸²æŸ“

### å¼‚æ­¥æ¸²æŸ“

Suspense æ˜¯ React æå‡ºçš„ä¸€ç§åŒæ­¥çš„ä»£ç æ¥å®ç°å¼‚æ­¥æ“ä½œçš„æ–¹æ¡ˆã€‚Suspense è®©ç»„ä»¶â€˜ç­‰å¾…â€™å¼‚æ­¥æ“ä½œï¼Œå¼‚æ­¥è¯·æ±‚ç»“æŸååœ¨è¿›è¡Œç»„ä»¶çš„æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å¼‚æ­¥æ¸²æŸ“ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½ç›®å‰è¿˜åœ¨å®éªŒé˜¶æ®µï¼Œç›¸ä¿¡ä¸ä¹…è¿™ç§å¼‚æ­¥æ¸²æŸ“çš„æ–¹å¼å°±èƒ½å’Œå¤§å®¶è§é¢äº†ã€‚

**Suspense ç”¨æ³•**

Suspense æ˜¯ç»„ä»¶ï¼Œæœ‰ä¸€ä¸ª fallback å±æ€§ï¼Œç”¨æ¥ä»£æ›¿å½“ Suspense å¤„äº loading çŠ¶æ€ä¸‹æ¸²æŸ“çš„å†…å®¹ï¼ŒSuspense çš„ children å°±æ˜¯å¼‚æ­¥ç»„ä»¶ã€‚å¤šä¸ªå¼‚æ­¥ç»„ä»¶å¯ä»¥ç”¨ Suspense åµŒå¥—ä½¿ç”¨ã€‚

æˆ‘å†™äº†ä¸€ä¸ªå¼‚æ­¥æ¸²æŸ“çš„ä¾‹å­å¦‚ä¸‹ã€‚

```js
// å­ç»„ä»¶
function UserInfo() {
  // è·å–ç”¨æˆ·æ•°æ®ä¿¡æ¯ï¼Œç„¶åå†æ¸²æŸ“ç»„ä»¶ã€‚
  const user = getUserInfo()
  return <h1>{user.name}</h1>
}
// çˆ¶ç»„ä»¶
export default function Index() {
  return (
    <Suspense fallback={<h1>Loading...</h1>}>
      <UserInfo />
    </Suspense>
  )
}
```

- Suspense åŒ…è£¹å¼‚æ­¥æ¸²æŸ“ç»„ä»¶ UserInfo ï¼Œå½“ UserInfo å¤„äºæ•°æ®åŠ è½½çŠ¶æ€ä¸‹ï¼Œå±•ç¤º Suspense ä¸­ fallback çš„å†…å®¹ã€‚

å¦‚ä¸Šæ‰€ç¤ºï¼Œå¼‚æ­¥æ¸²æŸ“çš„ UserInfo ç»„ä»¶å¯ä»¥ç›´æ¥é€šè¿‡ getUserInfo è¯·æ±‚æ•°æ®ï¼Œç›´æ¥ç”¨æ•°æ® user è¿›è¡Œæ¸²æŸ“ï¼Œå¾ˆæ˜¾ç„¶ç°åœ¨æ˜¯åšä¸åˆ°çš„ã€‚ç°åœ¨çš„å¼‚æ­¥è¯·æ±‚æ–¹å¼æ¯”è¾ƒç¹çï¼Œä¸»è¦æ˜¯æ˜¯é€šè¿‡ç±»ç»„ä»¶ componentDidMount æˆ–è€…å‡½æ•°ç»„ä»¶ useEffect è¿›è¡Œæ•°æ®äº¤äº’ï¼Œè·å¾—æ•°æ®åé€šè¿‡è°ƒç”¨ setState æˆ– useState æ”¹å˜ state è§¦å‘è§†å›¾çš„æ›´æ–°ã€‚

**ä¼ ç»Ÿæ¨¡å¼ï¼šæŒ‚è½½ç»„ä»¶-> è¯·æ±‚æ•°æ® -> å†æ¸²æŸ“ç»„ä»¶ã€‚**

**å¼‚æ­¥æ¨¡å¼ï¼šè¯·æ±‚æ•°æ®-> æ¸²æŸ“ç»„ä»¶ã€‚**

é‚£ä¹ˆå¼‚æ­¥æ¸²æŸ“ç›¸æ¯”ä¼ ç»Ÿæ•°æ®äº¤äº’ç›¸æ¯”å¥½å¤„å°±æ˜¯ï¼š

- ä¸å†éœ€è¦ componentDidMount æˆ– useEffect é…åˆåšæ•°æ®äº¤äº’ï¼Œä¹Ÿä¸ä¼šå› ä¸ºæ•°æ®äº¤äº’åï¼Œæ”¹å˜ state è€Œäº§ç”Ÿçš„äºŒæ¬¡æ›´æ–°ä½œç”¨ã€‚
- ä»£ç é€»è¾‘æ›´ç®€å•ï¼Œæ¸…æ™°ã€‚

### åŠ¨æ€åŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰

ç°åœ¨çš„ Suspense é…åˆ React.lazy å¯ä»¥å®ç°åŠ¨æ€åŠ è½½åŠŸèƒ½ã€‚

**React.lazy**

```js
const LazyComponent = React.lazy(() => import('./text'))
```

React.lazy æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦åŠ¨æ€è°ƒç”¨ `import()` ã€‚å®ƒå¿…é¡»è¿”å›ä¸€ä¸ª Promise ï¼Œè¯¥ Promise éœ€è¦ resolve ä¸€ä¸ª default export çš„ React ç»„ä»¶ã€‚

å…ˆæ¥çœ‹ä¸€ä¸‹åŸºæœ¬ä½¿ç”¨ï¼š

```js
const LazyComponent = React.lazy(() => import('./test.js'))

export default function Index() {
  return (
    <Suspense fallback={<div>loading...</div>}>
      <LazyComponent />
    </Suspense>
  )
}
```

- ç”¨ React.lazy åŠ¨æ€å¼•å…¥ test.js é‡Œé¢çš„ç»„ä»¶ï¼Œé…åˆ Suspense å®ç°åŠ¨æ€åŠ è½½ç»„ä»¶æ•ˆæœã€‚**è¿™æ ·å¾ˆåˆ©äºä»£ç åˆ†å‰²ï¼Œä¸ä¼šè®©åˆå§‹åŒ–çš„æ—¶å€™åŠ è½½å¤§é‡çš„æ–‡ä»¶ã€‚**

åŸç†æ­ç§˜ï¼š **React.lazyå’ŒSuspenseå®ç°åŠ¨æ€åŠ è½½åŸç†**

æ•´ä¸ª render è¿‡ç¨‹éƒ½æ˜¯åŒæ­¥æ‰§è¡Œä¸€æ°”å‘µæˆçš„ï¼Œä½†æ˜¯åœ¨ Suspense å¼‚æ­¥ç»„ä»¶æƒ…å†µä¸‹å…è®¸**è°ƒç”¨ Render => å‘ç°å¼‚æ­¥è¯·æ±‚ => æ‚¬åœï¼Œç­‰å¾…å¼‚æ­¥è¯·æ±‚å®Œæ¯• => å†æ¬¡æ¸²æŸ“å±•ç¤ºæ•°æ®**ã€‚

**é‚£ä¹ˆæ•´ä¸ªæµç¨‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Œé€æ­¥åˆ†æä¸€ä¸‹:**

**SuspenseåŸç†ï¼š** <br/>

**Suspense åœ¨æ‰§è¡Œå†…éƒ¨å¯ä»¥é€šè¿‡ `try{}catch{}` æ–¹å¼æ•è·å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸é€šå¸¸æ˜¯ä¸€ä¸ª `Promise` ï¼Œå¯ä»¥åœ¨è¿™ä¸ª Promise ä¸­è¿›è¡Œæ•°æ®è¯·æ±‚å·¥ä½œï¼ŒSuspense å†…éƒ¨ä¼šå¤„ç†è¿™ä¸ª Promise ï¼ŒPromise ç»“æŸåï¼ŒSuspense ä¼šå†ä¸€æ¬¡é‡æ–° render æŠŠæ•°æ®æ¸²æŸ“å‡ºæ¥ï¼Œè¾¾åˆ°å¼‚æ­¥æ¸²æŸ“çš„æ•ˆæœã€‚**

![1.jpg](http://blog.minouccc.online:9000/blog/react_5.1.png)

**React.lazyåŸç†ï¼š**

å†çœ‹ä¸€ä¸‹ React.lazyï¼Œlazy å†…éƒ¨æ¨¡æ‹Ÿä¸€ä¸ª promiseA è§„èŒƒåœºæ™¯ã€‚å®Œå…¨å¯ä»¥ç†è§£ React.lazy ç”¨ Promise æ¨¡æ‹Ÿäº†ä¸€ä¸ªè¯·æ±‚æ•°æ®çš„è¿‡ç¨‹ï¼Œä½†æ˜¯è¯·æ±‚çš„ç»“æœä¸æ˜¯æ•°æ®ï¼Œè€Œæ˜¯ä¸€ä¸ªåŠ¨æ€çš„ç»„ä»¶ã€‚ä¸‹ä¸€æ¬¡æ¸²æŸ“å°±ç›´æ¥æ¸²æŸ“è¿™ä¸ªç»„ä»¶ï¼Œæ‰€ä»¥æ˜¯ React.lazy åˆ©ç”¨ Suspense **æ¥æ”¶ Promise ï¼Œæ‰§è¡Œ Promise ï¼Œç„¶åå†æ¸²æŸ“**è¿™ä¸ªç‰¹æ€§åšåˆ°åŠ¨æ€åŠ è½½çš„ã€‚è¯´åˆ°è¿™å¯èƒ½æœ‰å¾ˆå¤šåŒå­¦ä¸æ˜ç™½ä»€ä¹ˆæ„æ€ï¼Œä¸è¦ç´§ï¼Œæ¥ä¸‹æ¥é€šè¿‡ä»¥ä¸‹ä»£ç åŠ æ·±ä¸€ä¸‹å¯¹ lazy + susponse çš„ç†è§£ã€‚

> react/src/ReactLazy.js

```js
function lazy(ctor) {
  return {
    $$typeof: REACT_LAZY_TYPE,
    _payload: {
      _status: -1, //åˆå§‹åŒ–çŠ¶æ€
      _result: ctor,
    },
    _init: function (payload) {
      if (payload._status === -1) {
        /* ç¬¬ä¸€æ¬¡æ‰§è¡Œä¼šèµ°è¿™é‡Œ  */
        const ctor = payload._result
        const thenable = ctor()
        payload._status = Pending
        payload._result = thenable
        thenable.then((moduleObject) => {
          const defaultExport = moduleObject.default
          resolved._status = Resolved // 1 æˆåŠŸçŠ¶æ€
          resolved._result = defaultExport /* defaultExport ä¸ºæˆ‘ä»¬åŠ¨æ€åŠ è½½çš„ç»„ä»¶æœ¬èº«  */
        })
      }
      if (payload._status === Resolved) {
        // æˆåŠŸçŠ¶æ€
        return payload._result
      } else {
        //ç¬¬ä¸€æ¬¡ä¼šæŠ›å‡ºPromiseå¼‚å¸¸ç»™Suspense
        throw payload._result
      }
    },
  }
}
```

æ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼ŒReact.lazy åŒ…è£¹çš„ç»„ä»¶ä¼šæ ‡è®° `REACT_LAZY_TYPE` ç±»å‹çš„ elementï¼Œåœ¨è°ƒå’Œé˜¶æ®µä¼šå˜æˆ LazyComponent ç±»å‹çš„ fiber ï¼ŒReact å¯¹ LazyComponent ä¼šæœ‰å•ç‹¬çš„å¤„ç†é€»è¾‘ï¼š

- ç¬¬ä¸€æ¬¡æ¸²æŸ“é¦–å…ˆä¼šæ‰§è¡Œ init æ–¹æ³•ï¼Œé‡Œé¢ä¼šæ‰§è¡Œ lazy çš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªPromiseï¼Œç»‘å®š Promise.then æˆåŠŸå›è°ƒï¼Œå›è°ƒé‡Œå¾—åˆ°å°†è¦æ¸²æŸ“ç»„ä»¶ `defaultExport` ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä¸Šé¢çš„å‡½æ•°å½“ç¬¬äºŒä¸ª if åˆ¤æ–­çš„æ—¶å€™ï¼Œå› ä¸ºæ­¤æ—¶çŠ¶æ€ä¸æ˜¯ Resolved ï¼Œæ‰€ä»¥ä¼šèµ° else ï¼ŒæŠ›å‡ºå¼‚å¸¸ Promiseï¼ŒæŠ›å‡ºå¼‚å¸¸ä¼šè®©å½“å‰æ¸²æŸ“ç»ˆæ­¢ã€‚

- è¿™ä¸ªå¼‚å¸¸ Promise ä¼šè¢« Suspense æ•è·åˆ°ï¼ŒSuspense ä¼šå¤„ç† Promise ï¼ŒPromise æ‰§è¡ŒæˆåŠŸå›è°ƒå¾—åˆ° defaultExportï¼ˆå°†æƒ³è¦æ¸²æŸ“ç»„ä»¶ï¼‰ï¼Œç„¶å Susponse å‘èµ·ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼Œç¬¬äºŒæ¬¡ init æ–¹æ³•å·²ç»æ˜¯ Resolved æˆåŠŸçŠ¶æ€ï¼Œé‚£ä¹ˆç›´æ¥è¿”å› result ä¹Ÿå°±æ˜¯çœŸæ­£æ¸²æŸ“çš„ç»„ä»¶ã€‚è¿™æ—¶å€™å°±å¯ä»¥æ­£å¸¸æ¸²æŸ“ç»„ä»¶äº†ã€‚

![2.jpg](http://blog.minouccc.online:9000/blog/react_5.2.png)

## ä¸‰ æ¸²æŸ“é”™è¯¯è¾¹ç•Œ

React ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹å¦‚æœæœ‰ä¸€ä¸ªç¯èŠ‚å‡ºç°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªç»„ä»¶æ¸²æŸ“å¤±è´¥ï¼Œé‚£ä¹ˆæ•´ä¸ªç»„ä»¶çš„ UI å±‚éƒ½ä¼šæ˜¾ç¤ºä¸å‡ºæ¥ï¼Œè¿™æ ·é€ æˆçš„å±å®³æ˜¯å·¨å¤§çš„ï¼Œå¦‚æœè¶Šé è¿‘ APP åº”ç”¨çš„æ ¹ç»„ä»¶ï¼Œæ¸²æŸ“è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜é€ æˆçš„å½±å“å°±è¶Šå¤§ï¼Œæœ‰å¯èƒ½ç›´æ¥é€ æˆç™½å±çš„æƒ…å†µã€‚

æ¯”å¦‚å¦‚ä¸‹ä¾‹å­

```js
function ErrorTest() {
  return
}
function Test() {
  return <div>let us learn React!</div>
}

class Index extends React.Component {
  componentDidCatch(...arg) {
    console.log(arg)
  }
  render() {
    return (
      <div>
        <ErrorTest />
        <div> hello, my name is alien! </div>
        <Test />
      </div>
    )
  }
}
```

- é€ æˆé”™è¯¯ï¼Œç”±äº ErrorTest ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„ç»„ä»¶ä½†æ˜¯å´ç”¨æ¥æ¸²æŸ“ï¼Œç»“æœä¼šé€ æˆæ•´ä¸ª Index ç»„ä»¶æ¸²æŸ“å¼‚å¸¸ï¼ŒTest ä¹Ÿä¼šå—åˆ°ç‰µè¿ï¼ŒUI éƒ½ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚

ä¸ºäº†é˜²æ­¢å¦‚ä¸Šçš„æ¸²æŸ“å¼‚å¸¸æƒ…å†µ React å¢åŠ äº† `componentDidCatch` å’Œ `static getDerivedStateFromError()` ä¸¤ä¸ªé¢å¤–çš„ç”Ÿå‘½å‘¨æœŸï¼Œå»æŒ½æ•‘ç”±äºæ¸²æŸ“é˜¶æ®µå‡ºç°é—®é¢˜é€ æˆ UI ç•Œé¢æ— æ³•æ˜¾ç¤ºçš„æƒ…å†µã€‚

### componentDidCatch

componentDidCatch å¯ä»¥æ•è·å¼‚å¸¸ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

- 1 error â€”â€” æŠ›å‡ºçš„é”™è¯¯ã€‚
- 2 info â€”â€” å¸¦æœ‰ componentStack key çš„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³ç»„ä»¶å¼•å‘é”™è¯¯çš„æ ˆä¿¡æ¯ã€‚
  å…ˆæ¥æ‰“å°ä¸€ä¸‹ï¼Œç”Ÿå‘½å‘¨æœŸ componentDidCatch å‚æ•°é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ

![3.jpg](http://blog.minouccc.online:9000/blog/react_5.3.png)

é‚£ä¹ˆ componentDidCatch ä¸­å¯ä»¥å†æ¬¡è§¦å‘ setStateï¼Œæ¥é™çº§UIæ¸²æŸ“ï¼ŒcomponentDidCatch() ä¼šåœ¨commité˜¶æ®µè¢«è°ƒç”¨ï¼Œå› æ­¤å…è®¸æ‰§è¡Œå‰¯ä½œç”¨ã€‚

```js
class Index extends React.Component {
  state = {
    hasError: false,
  }
  componentDidCatch(...arg) {
    uploadErrorLog(arg) /* ä¸Šä¼ é”™è¯¯æ—¥å¿— */
    this.setState({
      /* é™çº§UI */ hasError: true,
    })
  }
  render() {
    const { hasError } = this.state
    return (
      <div>
        {hasError ? <div>ç»„ä»¶å‡ºç°é”™è¯¯</div> : <ErrorTest />}
        <div> hello, my name is alien! </div>
        <Test />
      </div>
    )
  }
}
```

æ•ˆæœï¼š

![4.jpg](http://blog.minouccc.online:9000/blog/react_5.4.png)
componentDidCatch ä½œç”¨ï¼š

- å¯ä»¥è°ƒç”¨ setState ä¿ƒä½¿ç»„ä»¶æ¸²æŸ“ï¼Œå¹¶åšä¸€äº›é”™è¯¯æ‹¦æˆªåŠŸèƒ½ã€‚
- ç›‘æ§ç»„ä»¶ï¼Œå‘ç”Ÿé”™è¯¯ï¼Œä¸ŠæŠ¥é”™è¯¯æ—¥å¿—ã€‚

### static getDerivedStateFromError

Reactæ›´æœŸæœ›ç”¨ getDerivedStateFromError ä»£æ›¿ componentDidCatch ç”¨äºå¤„ç†æ¸²æŸ“å¼‚å¸¸çš„æƒ…å†µã€‚getDerivedStateFromError æ˜¯é™æ€æ–¹æ³•ï¼Œå†…éƒ¨ä¸èƒ½è°ƒç”¨ setStateã€‚getDerivedStateFromError è¿”å›çš„å€¼å¯ä»¥åˆå¹¶åˆ° stateï¼Œä½œä¸ºæ¸²æŸ“ä½¿ç”¨ã€‚ç”¨ getDerivedStateFromError è§£å†³å¦‚ä¸Šçš„æƒ…å†µã€‚

```js
class Index extends React.Component {
  state = {
    hasError: false,
  }
  static getDerivedStateFromError() {
    return { hasError: true }
  }
  render() {
    /* å¦‚ä¸Š */
  }
}
```

å¦‚ä¸Šå®Œç¾è§£å†³äº† ErrorTest é”™è¯¯çš„é—®é¢˜ã€‚æ³¨æ„äº‹é¡¹ï¼š å¦‚æœå­˜åœ¨ getDerivedStateFromError ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œé‚£ä¹ˆå°†ä¸éœ€è¦ componentDidCatch ç”Ÿå‘½å‘¨æœŸå†é™çº§ uiã€‚

## å›› å®è·µ - React.lazy + Susponseæ¨¡æ‹Ÿå¼‚æ­¥ç»„ä»¶åŠŸèƒ½

æ¥ä¸‹æ¥ React.lazy + Susponse æ¥å®Œå…¨æ¨¡æ‹Ÿå®ç°ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ã€‚

**å®ç°æ•ˆæœï¼š**

- å¼‚æ­¥ç»„ä»¶è¦å®ç°çš„åŠŸèƒ½ï¼Œå¼‚æ­¥è¯·æ±‚æ•°æ®ï¼Œè¯·æ±‚å®Œæ•°æ®å†æŒ‚è½½ç»„ä»¶ã€‚æ²¡æœ‰åŠ è½½å®Œæ•°æ®æ˜¾ç¤º loading æ•ˆæœã€‚
- å¯é‡åŒ–ç”Ÿäº§ã€‚

**ä¸»è¦æ€è·¯ï¼š**

- å¯ä»¥ä½¿ç”¨ React.lazy å®ç°åŠ¨æ€åŠ è½½ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆè¯·æ±‚æ•°æ®ï¼Œç„¶åå†åŠ è½½ç»„ä»¶ï¼Œè¿™æ—¶å€™ä»¥ props å½¢å¼å°†æ•°æ®ä¼ é€’ç»™ç›®æ ‡ç»„ä»¶ï¼Œå®ç°å¼‚æ­¥æ•ˆæœã€‚

**ç¼–å†™ï¼š**

```js
/**
 *
 * @param {*} Component  éœ€è¦å¼‚æ­¥æ•°æ®çš„component
 * @param {*} api        è¯·æ±‚æ•°æ®æ¥å£,è¿”å›Promiseï¼Œå¯ä»¥å†thenä¸­è·å–ä¸åç«¯äº¤äº’çš„æ•°æ®
 * @returns
 */
function AysncComponent(Component, api) {
  const AysncComponentPromise = () =>
    new Promise(async (resolve) => {
      const data = await api()
      resolve({
        default: (props) => <Component rdata={data} {...props} />,
      })
    })
  return React.lazy(AysncComponentPromise)
}
```

**æ€è·¯ï¼š**

- ç”¨ AysncComponent ä½œä¸ºä¸€ä¸ª HOC åŒ…è£…ç»„ä»¶ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå½“å‰ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯·æ±‚æ•°æ®çš„ api ã€‚
- å£°æ˜ä¸€ä¸ªå‡½æ•°ç»™ React.lazy ä½œä¸ºå›è°ƒå‡½æ•°ï¼ŒReact.lazy è¦æ±‚è¿™ä¸ªå‡½æ•°å¿…é¡»æ˜¯è¿”å›ä¸€ä¸ª Promise ã€‚åœ¨ Promise é‡Œé¢é€šè¿‡è°ƒç”¨ api è¯·æ±‚æ•°æ®ï¼Œç„¶åæ ¹æ®è¿”å›æ¥çš„æ•°æ® rdata æ¸²æŸ“ç»„ä»¶ï¼Œåˆ«å¿˜äº†æ¥å—å¹¶ä¼ é€’ propsã€‚

**ä½¿ç”¨ï¼š**

```js
/* æ•°æ®æ¨¡æ‹Ÿ */
const getData = () => {
  return new Promise((resolve) => {
    //æ¨¡æ‹Ÿå¼‚æ­¥
    setTimeout(() => {
      resolve({
        name: 'alien',
        say: 'let us learn React!',
      })
    }, 1000)
  })
}
/* æµ‹è¯•å¼‚æ­¥ç»„ä»¶ */
function Test({ rdata, age }) {
  const { name, say } = rdata
  console.log('ç»„ä»¶æ¸²æŸ“')
  return (
    <div>
      <div> hello , my name is {name} </div>
      <div>age : {age} </div>
      <div> i want to say {say} </div>
    </div>
  )
}
/* çˆ¶ç»„ä»¶ */
export default class Index extends React.Component {
  LazyTest = AysncComponent(
    Test,
    getData
  ) /* éœ€è¦æ¯ä¸€æ¬¡åœ¨ç»„ä»¶å†…éƒ¨å£°æ˜ï¼Œä¿è¯æ¯æ¬¡çˆ¶ç»„ä»¶æŒ‚è½½ï¼Œéƒ½ä¼šé‡æ–°è¯·æ±‚æ•°æ® ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ */
  render() {
    const { LazyTest } = this
    return (
      <div>
        <Suspense fallback={<div>loading...</div>}>
          <LazyTest age={18} />
        </Suspense>
      </div>
    )
  }
}
```

**æ•ˆæœï¼š**

![5.gif](http://blog.minouccc.online:9000/blog/react_5.5.gif)

- å¦‚ä¸Š name å’Œ say éƒ½æ˜¯æ•°æ®äº¤äº’è·å–çš„æ•°æ®ã€‚
- ç»„ä»¶åªæ¸²æŸ“äº†ä¸€æ¬¡ï¼Œå®ç°äº†å¼‚æ­¥æ¸²æŸ“çš„æ•ˆæœã€‚

**æ€»ç»“ï¼š**

è¿™ä¸ªdemoä»…ä¾›å¤§å®¶å‚è€ƒï¼ŒåŠ æ·±ä»¥ä¸‹å¯¹å¼‚æ­¥ç»„ä»¶å’Œ HOC çš„ç†è§£ï¼Œä½†æ˜¯è¿™ç§åœ¨çœŸå®çš„å¼€å‘åœºæ™¯ä¹Ÿä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚

- 1 éœ€è¦çº¦å®šå¥½æ¥å—æ•°æ®æ ¼å¼rdataå’Œæ•°æ®äº¤äº’å½¢å¼apiã€‚
- 2 å› ä¸ºæ•°æ®æœ¬è´¨æ˜¯ç”¨é—­åŒ…ç¼“å­˜çš„ï¼Œæ‰€ä»¥ç»‘å®šéœ€è¦åœ¨åœ¨ç»„ä»¶å†…éƒ¨ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ¯æ¬¡çˆ¶ç»„ä»¶æŒ‚è½½ï¼Œéƒ½ä¼šé‡æ–°è¯·æ±‚æ•°æ®ï¼Œå¦å¤–ä¹Ÿé˜²æ­¢å†…å­˜æ³„æ¼æƒ…å†µå‘ç”Ÿã€‚
- 3 æ•°æ®æºæ›´æ–°ç»´æŠ¤å›°éš¾ã€‚

## äº” æ€»ç»“

è¿™èŠ‚ä¸»è¦è®²äº† React æœªæ¥ç‰ˆæœ¬çš„å¼‚æ­¥ç»„ä»¶ï¼ŒReact.lazy + Susponse åŠ¨æ€åŠ è½½åŸç†ï¼Œæ¸²æŸ“çš„é”™è¯¯è¾¹ç•ŒåŠå…¶å¤„ç†ï¼Œdiff æ€§èƒ½è°ƒä¼˜ï¼Œä»¥åŠç”¨ä¸€ä¸ªå®è·µ demo ï¼Œlazy + susponse æ¨¡æ‹Ÿå®ç°äº†å¼‚æ­¥ç»„ä»¶ã€‚
